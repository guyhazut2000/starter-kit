---
description: Git conventions, commit message format, branch naming, and PR requirements
globs: ["**/*"]
alwaysApply: true
---

# Git Conventions

## Commit Message Format

### Conventional Commits

Use [Conventional Commits](https://www.conventionalcommits.org/) format:

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Types

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `style`: Code style changes (formatting, missing semicolons, etc.)
- `refactor`: Code refactoring
- `perf`: Performance improvements
- `test`: Adding or updating tests
- `chore`: Maintenance tasks (dependencies, build config, etc.)
- `ci`: CI/CD changes
- `build`: Build system changes
- `revert`: Revert previous commit

### Scope (Optional)

- Feature name: `feat(products): add product search`
- Component name: `fix(ProductCard): resolve image loading issue`
- Area of codebase: `refactor(auth): simplify login flow`

### Examples

**Good Commit Messages:**

```
feat(products): Add product search functionality

Implement search with debouncing and filters.
Add search results pagination.

Closes #123
```

```
fix(auth): Resolve login redirect issue

Fix redirect loop when user is already authenticated.
Add proper session check before redirect.

Fixes #456
```

```
docs: Update README with setup instructions

Add detailed setup instructions for new developers.
Include environment variable configuration.
```

```
refactor(users): Simplify user creation flow

Extract validation logic into separate utility.
Improve error handling in user creation.

Related to #789
```

**Bad Commit Messages:**

```
Update code
```

```
fix
```

```
WIP
```

```
feat: stuff
- did things
- more changes
```

### Commit Message Rules

- **Subject line**: 50 characters or less, imperative mood
- **Body**: Explain what and why, wrap at 72 characters
- **Footer**: Reference issues (`Closes #123`, `Fixes #456`)
- **One change per commit**: Each commit should do one thing
- **No period at end of subject**: Keep it concise

## Branch Naming

### Format

```
<type>/<description>
```

### Types

- `feature/`: New features
- `bugfix/` or `fix/`: Bug fixes
- `hotfix/`: Urgent production fixes
- `refactor/`: Code refactoring
- `docs/`: Documentation updates
- `test/`: Adding tests
- `chore/`: Maintenance tasks

### Examples

**Good Branch Names:**

```
feature/user-authentication
feature/product-search-with-filters
bugfix/login-redirect-loop
hotfix/critical-security-patch
refactor/api-response-handling
docs/api-documentation-update
```

**Bad Branch Names:**

```
feature
fix
new-feature
updates
branch1
test
```

### Branch Naming Rules

- Use lowercase letters
- Use hyphens to separate words
- Be descriptive but concise
- Include issue/ticket numbers if applicable: `feature/PROJ-123-user-login`
- No special characters except hyphens

## Pull Request Guidelines

### PR Title

Follow commit message format:

```
<type>: <short description>
```

Examples:

- `feat: Add user authentication with OAuth`
- `fix: Resolve memory leak in image processing`
- `docs: Update API documentation for v2`

### PR Description Template

```markdown
## Description

Brief description of what this PR does and why.

## Type of Change

- [ ] Bug fix
- [ ] New feature
- [ ] Breaking change
- [ ] Documentation update

## Related Issues

Closes #123
Related to #456

## Changes Made

- Change 1
- Change 2
- Change 3

## Testing

- [ ] Unit tests added/updated
- [ ] Integration tests added/updated
- [ ] Manual testing performed
- [ ] All tests pass locally

## Checklist

- [ ] Code follows project style guidelines
- [ ] Self-review completed
- [ ] Comments added for complex code
- [ ] Documentation updated
- [ ] No new warnings generated
- [ ] Tests added/updated and passing
- [ ] Dependencies updated (if applicable)
```

### PR Requirements

**Before Creating PR:**

- [ ] Branch is up to date with `main`
- [ ] All tests pass locally
- [ ] Linting passes
- [ ] Build succeeds
- [ ] Commit messages follow conventions
- [ ] PR description is complete
- [ ] Related issues are linked

**Before Merging:**

- [ ] At least one approval
- [ ] All CI checks pass
- [ ] Branch is up to date
- [ ] All conversations resolved
- [ ] PR description is accurate

## Git Workflow

### ⚠️ MANDATORY: Creating a Branch (ALWAYS Follow This)

**FOR EVERY FEATURE OR TASK, YOU MUST:**

1. **Start from master/main**:

   ```bash
   # Switch to master/main
   git checkout master
   # OR
   git checkout main

   # Pull latest code
   git pull origin master
   # OR
   git pull origin main

   # Verify you're up to date
   git status
   ```

2. **Create new branch FROM master/main**:

   ```bash
   # Create and switch to new branch from master
   git checkout -b feature/feature-name master
   # OR
   git checkout -b feature/feature-name main

   # Verify you're on the new branch
   git branch --show-current
   ```

3. **NEVER branch from another feature branch** - Always branch from master/main

4. **NEVER start work on an existing feature branch** - Always create a fresh branch from master

### Why This Prevents Conflicts

- Starting from latest master ensures you have all recent changes
- Creating fresh branches prevents merge conflicts from old branches
- Syncing with master before PR ensures compatibility
- Clean branch history makes reviews easier

### Making Commits

```bash
# Stage changes
git add .

# Or stage specific files
git add path/to/file.ts

# Commit with message
git commit -m "feat(products): Add product search"

# Or use interactive commit for longer messages
git commit
```

### Syncing with Master/Main (BEFORE Creating PR)

**⚠️ ALWAYS sync with master/main before creating a PR:**

```bash
# 1. Ensure master/main is up to date
git checkout master
git pull origin master

# 2. Switch back to your feature branch
git checkout feature/feature-name

# 3. Fetch latest changes
git fetch origin

# 4. Merge master into your branch
git merge origin/master
# OR
git merge origin/main

# 5. If conflicts occur, resolve them:
# - Review conflicted files
# - Resolve conflicts manually
# - Test after resolving
# - Commit the merge

# 6. Push updated branch
git push origin feature/feature-name
```

**Alternative: Rebase (if preferred)**

```bash
git checkout feature/feature-name
git fetch origin
git rebase origin/master
# Resolve conflicts if any
git push origin feature/feature-name --force-with-lease
```

**⚠️ IMPORTANT**: Always sync with master/main BEFORE creating PR to avoid conflicts.

### ⚠️ MANDATORY: Post-Merge Workflow (ALWAYS Follow This)

**AFTER A PR IS MERGED ON GITHUB, YOU MUST:**

1. **Switch back to master/main**:

   ```bash
   # Switch to master/main
   git checkout master
   # OR
   git checkout main
   ```

2. **Pull the merged changes from remote**:

   ```bash
   # Pull latest changes (including your merged PR)
   git pull origin master
   # OR
   git pull origin main

   # Verify you're up to date
   git status
   git log --oneline -5  # See recent commits
   ```

3. **MANDATORY: Clean up merged branches**:

   ```bash
   # Delete the local feature branch (it's already merged)
   git branch -d feature/feature-name

   # If branch was force-pushed or has diverged, use -D to force delete
   # git branch -D feature/feature-name

   # Delete remote branch (if not auto-deleted by GitHub)
   git push origin --delete feature/feature-name

   # Clean up stale remote branch references
   git remote prune origin
   ```

   **Why delete merged branches?**

   - ✅ Keeps repository clean and organized
   - ✅ All commits remain in git history (nothing is lost)
   - ✅ Can recreate branch from history if needed
   - ✅ Standard industry best practice
   - ✅ Makes it clear which branches are active vs merged

   **When to keep temporarily (rare cases):**

   - Hotfix needed immediately after merge (keep for 1-2 days max)
   - Related follow-up work planned (delete after follow-up is done)
   - Uncertain if merge was successful (verify, then delete)

   **Recovering deleted branch (if needed):**

   ```bash
   # Find the merge commit
   git log --oneline --merges

   # Or find commits by message
   git log --all --grep="feature name" --oneline

   # Recreate branch from merge commit
   git checkout -b feature/feature-name <merge-commit-hash>
   ```

4. **Verify you're ready for next feature**:

   ```bash
   # Confirm you're on master/main
   git branch --show-current

   # Confirm you're up to date
   git status
   ```

5. **Start next feature**: Now you can create a new branch from the updated master/main

**Why This Is Critical:**

- ✅ Ensures you always start new features from the latest code
- ✅ Prevents working on outdated code
- ✅ Keeps your local master/main in sync with remote
- ✅ Avoids merge conflicts in future features
- ✅ Maintains clean git history

**⚠️ CRITICAL RULE**: **NEVER start a new feature without first pulling latest master/main after a merge.**

### Complete Feature Workflow Summary

**Full cycle from start to finish:**

1. **Start Feature**:

   ```bash
   git checkout master
   git pull origin master
   git checkout -b feature/new-feature master
   ```

2. **Work on Feature**:

   - Make commits
   - Push to remote
   - Create PR

3. **After PR Merged** (on GitHub):

   ```bash
   git checkout master
   git pull origin master
   git branch -d feature/new-feature  # Delete local branch
   git push origin --delete feature/new-feature  # Delete remote branch
   git remote prune origin  # Clean up stale references
   ```

4. **Start Next Feature**:
   ```bash
   git checkout master  # Already up to date from step 3
   git pull origin master  # Double-check
   git checkout -b feature/next-feature master
   ```

**Remember**: Always be up to date with master branch before starting any new work.

### Branch Cleanup Best Practices

**⚠️ MANDATORY: Always delete merged branches**

After a PR is merged, you MUST clean up both local and remote branches:

```bash
# 1. Switch to master and pull latest
git checkout master
git pull origin master

# 2. Delete local branch
git branch -d feature/feature-name

# 3. Delete remote branch (if not auto-deleted)
git push origin --delete feature/feature-name

# 4. Clean up stale references
git remote prune origin
```

**Why delete merged branches?**

- ✅ **Keeps repository clean**: Only active branches remain visible
- ✅ **Nothing is lost**: All commits remain in git history forever
- ✅ **Easy recovery**: Can recreate branch from history if needed
- ✅ **Best practice**: Standard industry practice for all teams
- ✅ **Clear active work**: Makes it obvious which branches are in progress
- ✅ **Prevents confusion**: Avoids working on old merged branches

**What happens when you delete a branch?**

- ✅ All commits remain in git history
- ✅ You can still see them with `git log`
- ✅ PR history remains on GitHub
- ✅ You can recreate the branch from any commit hash
- ✅ Nothing is permanently lost

**When to keep a branch temporarily (rare exceptions):**

- **Hotfix needed immediately**: Keep for 1-2 days max, then delete
- **Related follow-up work**: Keep until follow-up is done, then delete
- **Uncertain merge success**: Verify merge, then delete

**How to recover a deleted branch (if needed):**

```bash
# Find the merge commit or any commit from that branch
git log --oneline --merges
git log --all --grep="feature name" --oneline

# Recreate branch from merge commit
git checkout -b feature/feature-name <merge-commit-hash>

# Or recreate from any commit in that branch
git checkout -b feature/feature-name <commit-hash>
```

**GitHub Auto-Delete Setting (Recommended):**

Enable automatic deletion of merged branches in GitHub:

1. Go to repository **Settings**
2. Navigate to **General** → **Pull Requests**
3. Enable **"Automatically delete head branches"**

This will automatically delete remote branches after PR merge, so you only need to delete local branches.

**⚠️ CRITICAL RULE**: **Always delete merged branches. This is not optional - it's a mandatory part of the workflow.**

### Pushing Changes

```bash
# Push branch to remote
git push origin feature/feature-name

# Push and set upstream
git push -u origin feature/feature-name

# Force push (use with caution, only if needed)
git push --force-with-lease
```

## Commit Frequency

- **Small, frequent commits**: Commit logical units of work
- **One change per commit**: Each commit should do one thing
- **Commit often**: Don't wait until feature is complete
- **Meaningful commits**: Each commit should be meaningful and reviewable

## Best Practices

### DO

- ✅ Write clear, descriptive commit messages
- ✅ Use Conventional Commits format
- ✅ Reference issues in commit messages
- ✅ Keep commits small and focused
- ✅ Test before committing
- ✅ Sync with main regularly
- ✅ Review your own commits before pushing

### DON'T

- ❌ Commit directly to `main` branch
- ❌ Write vague commit messages
- ❌ Commit broken code
- ❌ Commit large, unrelated changes together
- ❌ Force push to `main`
- ❌ Skip pre-commit hooks (if configured)
- ❌ Commit secrets or credentials

## Pre-commit Hooks (If Configured)

If using Husky or similar:

- Run linting on staged files
- Run formatting on staged files
- Run type checking
- Prevent commits with errors

## Merge Strategies

### Squash and Merge (Recommended)

- Combines all commits into a single commit
- Cleaner git history
- Easier to revert if needed
- Use for feature branches

### Merge Commit

- Preserves individual commit history
- Use when commit history is important
- Creates merge commit in history

### Rebase and Merge

- Linear history without merge commits
- Use when you want completely linear history
- Can be more complex for reviewers

## Reference

For detailed workflow guidelines, see `github_flow.mdc`.
