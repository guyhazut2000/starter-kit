---
description: Dependency management, versioning strategy, security, and update procedures
globs: ["**/*"]
alwaysApply: true
---

# Dependency Management

## Package Manager

**Primary**: npm (Node Package Manager)

**Alternative Options:**
- yarn
- pnpm
- bun

_Use one package manager consistently across the project._

## Dependency Categories

### Dependencies (Production)

**Core Framework:**
- `next`: Next.js framework
- `react`: React library
- `react-dom`: React DOM renderer

**Data & Validation:**
- `@prisma/client`: Prisma ORM client
- `zod`: Runtime validation

**State Management:**
- `@tanstack/react-query`: Server state management

**UI & Styling:**
- `tailwindcss`: CSS framework
- `@radix-ui/react-*`: Headless UI components (via Shadcn)

**Logging:**
- `winston`: Structured logging

### DevDependencies (Development)

**TypeScript:**
- `typescript`: TypeScript compiler
- `@types/node`: Node.js type definitions
- `@types/react`: React type definitions
- `@types/react-dom`: React DOM type definitions

**Linting & Formatting:**
- `eslint`: Linter
- `eslint-config-next`: Next.js ESLint config

**Testing:**
- `jest`: Test runner
- `@testing-library/react`: Component testing
- `@testing-library/jest-dom`: DOM matchers
- `@testing-library/user-event`: User interaction

**Build Tools:**
- `@tailwindcss/postcss`: PostCSS plugin

## Versioning Strategy

### Version Ranges

**Major Updates (Breaking Changes):**
- Use `^` for minor/patch updates: `"next": "^16.1.2"`
- Review breaking changes before major updates
- Test thoroughly after major updates

**Critical Dependencies:**
- Consider exact versions for critical packages
- Lock versions for security-sensitive packages

**Example:**
```json
{
  "dependencies": {
    "next": "^16.1.2",        // Allow minor/patch updates
    "react": "^19.2.3",       // Allow minor/patch updates
    "zod": "^3.22.0"          // Allow minor/patch updates
  }
}
```

### Lock Files

**`package-lock.json`:**
- Automatically generated by npm
- Locks exact versions of all dependencies
- **Commit to version control**
- Ensures consistent installs across environments

## Security

### Vulnerability Scanning

**Regular Checks:**
```bash
# Check for vulnerabilities
npm audit

# Fix automatically fixable issues
npm audit fix

# Review and fix manually
npm audit --audit-level=moderate
```

**CI Integration:**
- Run `npm audit` in CI pipeline
- Fail build on high/critical vulnerabilities
- Regular automated security scans

### Dependency Updates

**Update Strategy:**
1. **Regular Updates**: Monthly dependency review
2. **Security Updates**: Immediate for critical vulnerabilities
3. **Major Updates**: Plan and test thoroughly
4. **Minor/Patch**: Update regularly, test before deploying

**Update Process:**
```bash
# Check outdated packages
npm outdated

# Update specific package
npm update package-name

# Update all packages (careful!)
npm update

# Major version updates
npm install package-name@latest
```

## Adding Dependencies

### Process

1. **Evaluate Need**: Is this dependency necessary?
2. **Check Alternatives**: Are there lighter alternatives?
3. **Review License**: Check license compatibility
4. **Check Maintenance**: Is package actively maintained?
5. **Check Bundle Size**: Impact on application size
6. **Install**: `npm install package-name`
7. **Test**: Verify it works as expected
8. **Document**: Update documentation if needed

### Adding to package.json

**Production Dependency:**
```bash
npm install package-name
```

**Development Dependency:**
```bash
npm install -D package-name
```

**Specific Version:**
```bash
npm install package-name@1.2.3
```

## Removing Dependencies

### Process

1. **Identify Unused**: Check if dependency is actually used
2. **Remove**: `npm uninstall package-name`
3. **Test**: Ensure application still works
4. **Clean**: Remove unused imports and code
5. **Update Lock File**: `package-lock.json` updated automatically

## Prisma Dependencies

### Prisma Client

**Generation:**
```bash
# Generate Prisma Client after schema changes
npx prisma generate
```

**When to Generate:**
- After schema changes
- After installing Prisma
- In CI/CD pipeline before build

### Prisma Migrations

**Migration Files:**
- Stored in `prisma/migrations/`
- **Commit to version control**
- Never delete applied migrations
- Review migration SQL before applying

## Peer Dependencies

### Handling Peer Dependencies

**React:**
- Ensure compatible React version
- Next.js manages React version compatibility

**Node.js:**
- Specify in `package.json`:
```json
{
  "engines": {
    "node": ">=20.0.0"
  }
}
```

## Dependency Conflicts

### Resolving Conflicts

1. **Identify Conflict**: Check `npm install` output
2. **Check Versions**: Review conflicting packages
3. **Update Dependencies**: Update to compatible versions
4. **Use Resolutions** (if needed):
```json
{
  "overrides": {
    "package-name": "1.2.3"
  }
}
```

## Best Practices

### DO

- ✅ Keep dependencies up to date
- ✅ Review dependencies before adding
- ✅ Use `^` for version ranges (allow updates)
- ✅ Commit `package-lock.json` to version control
- ✅ Run `npm audit` regularly
- ✅ Update security vulnerabilities immediately
- ✅ Test after dependency updates
- ✅ Document why dependencies are needed
- ✅ Remove unused dependencies

### DON'T

- ❌ Add dependencies without evaluation
- ❌ Use `*` for version ranges
- ❌ Ignore security vulnerabilities
- ❌ Skip testing after updates
- ❌ Commit `node_modules/` to version control
- ❌ Use deprecated packages
- ❌ Add duplicate functionality packages

## Dependency Audit Checklist

**Before Adding:**
- [ ] Is this dependency necessary?
- [ ] Are there lighter alternatives?
- [ ] Is it actively maintained?
- [ ] Is the license compatible?
- [ ] What's the bundle size impact?
- [ ] Are there security concerns?

**Regular Maintenance:**
- [ ] Review outdated packages monthly
- [ ] Update security vulnerabilities immediately
- [ ] Test after dependency updates
- [ ] Remove unused dependencies
- [ ] Document dependency decisions

## Common Dependencies Reference

### Core (Always Present)
- `next`: Next.js framework
- `react`: React library
- `react-dom`: React DOM
- `typescript`: TypeScript

### Data Layer
- `@prisma/client`: Database ORM
- `prisma`: Prisma CLI
- `zod`: Validation

### State Management
- `@tanstack/react-query`: Server state

### UI
- `tailwindcss`: Styling
- `@radix-ui/react-*`: UI primitives

### Development
- `eslint`: Linting
- `jest`: Testing
- `@testing-library/react`: Component testing

### Logging
- `winston`: Structured logging

## Version Pinning Strategy

**Pin Versions For:**
- Critical security packages
- Packages with breaking changes
- Packages with compatibility issues

**Use Ranges For:**
- Well-maintained packages
- Packages with stable APIs
- Framework packages (Next.js, React)

## Update Schedule

**Weekly:**
- Security vulnerability checks
- Critical security updates

**Monthly:**
- Review outdated packages
- Update minor/patch versions
- Test and deploy updates

**Quarterly:**
- Major version review
- Evaluate new alternatives
- Remove unused dependencies
